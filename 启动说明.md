# 人物立绘展示应用 - 启动说明

## 快速开始

### 1. 文件结构
确保你的项目结构如下：
```
NekoBox/
├── index.html          # 主页面
├── app.js              # 应用逻辑
├── config.js           # 配置文件
├── driver/             # FreeMote 驱动文件
│   ├── FreeMoteDriver.js
│   ├── emoteplayer.js
│   └── iemote.h
├── data/               # PSB 文件目录
│   └── choco.psb       # 你的 PSB 文件
└── 启动说明.md
```

### 2. 配置 PSB 文件

编辑 `config.js` 文件，添加你的 PSB 文件：

```javascript
characterFiles: [
    'data/choco.psb',
    'data/character2.psb',  // 添加更多文件
    'data/character3.psb',
],
```

### 3. 配置表情映射

根据你的 PSB 文件中的实际表情标签，修改 `config.js` 中的表情列表：

```javascript
emotions: [
    '平常', '微笑', '开心', '害羞', '生气', '悲伤', '惊讶', '困惑',
    // 添加或修改表情名称
],
```

### 4. 启动本地服务器

由于浏览器安全限制，需要通过 HTTP 服务器访问：

#### 方法一：使用 Python
```bash
# Python 3
python -m http.server 8080

# Python 2
python -m SimpleHTTPServer 8080
```

#### 方法二：使用 Node.js
```bash
# 安装 http-server
npm install -g http-server

# 启动服务器
http-server -p 8080
```

#### 方法三：使用 Live Server (VS Code)
1. 安装 Live Server 扩展
2. 右键 `index.html` 选择 "Open with Live Server"

### 5. 访问应用

打开浏览器访问：`http://localhost:8080`

### 6. 测试移动端功能

1. 在Chrome开发者工具中切换到移动设备模式
2. 选择任意移动设备（如iPhone或Android）
3. 双击屏幕测试菜单功能
4. 如果双击不工作，可以先访问 `http://localhost:8080/test.html` 测试双击功能

**注意**：移动端双击需要快速连续点击两次（间隔小于500ms）

### 7. 调试显示问题

如果遇到显示问题（人物太小或显示区域裁切），可以：

1. 访问 `http://localhost:8080/debug.html` 查看画布尺寸和显示区域
2. 打开浏览器控制台查看调试信息
3. 检查画布尺寸是否正确设置为窗口大小
4. 确认人物位置是否在预期的45%高度位置

## 功能说明

### 基本操作
- **双击屏幕**：打开/关闭菜单
- **缩放滑块**：调整人物大小
- **表情按钮**：切换不同表情
- **人物选择**：切换不同角色
- **ESC 键**：关闭菜单

### 🎯 交互功能

#### 视线跟踪
- **鼠标移动**：角色会跟随鼠标移动视线
- **头部跟踪**：当鼠标距离较远时，角色会转动头部
- **身体跟踪**：当鼠标距离很远时，角色会转动身体

#### 点击交互
- **点击胸部区域**：角色会生气并做出防御动作
- **点击眼睛区域**：角色会困惑并眨眼

#### 表情动作
- **平常**：默认表情
- **怒る01**：生气表情
- **困る00**：困惑表情
- **びっくり2**：惊讶表情
- **いやいや**：摇头动作
- **ひく**：退缩动作

### 移动端支持
- 支持触摸操作
- 响应式设计
- 防止页面缩放

## 🧪 功能测试

如果遇到交互问题，可以使用测试页面：
- 访问 `http://localhost:8080/test-interaction.html`
- 这个页面专门用于测试视线跟踪、点击交互和表情功能
- 包含详细的调试信息，帮助排查问题

## 调试建议

### 1. 检查控制台
打开浏览器开发者工具，查看 Console 标签页的错误信息。

### 2. 常见问题
- **文件加载失败**：检查 PSB 文件路径是否正确
- **表情不显示**：检查 PSB 文件中的表情标签名称
- **页面空白**：确保通过 HTTP 服务器访问，而不是直接打开文件

### 3. 性能优化
- 大文件加载时显示加载界面
- 支持多角色切换
- 自动调整画布大小

## 自定义配置

### 修改默认设置
在 `config.js` 中修改：
```javascript
defaultScale: 1.0,        // 默认缩放
defaultEmotion: '平常',    // 默认表情
```

### 添加新角色
1. 将 PSB 文件放入 `data/` 目录
2. 在 `config.js` 的 `characterFiles` 数组中添加文件路径
3. 可选：在 `characterNames` 中添加自定义显示名称

### 自定义表情
1. 检查 PSB 文件中的表情标签名称
2. 在 `config.js` 的 `emotions` 数组中添加表情名称
3. 如果需要映射，在 `emotionMapping` 中配置

## 技术支持

如果遇到问题，请检查：
1. 浏览器是否支持 WebGL
2. PSB 文件格式是否正确
3. 文件路径是否正确
4. 是否通过 HTTP 服务器访问
